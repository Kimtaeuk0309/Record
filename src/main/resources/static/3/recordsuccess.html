<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>저장된 기록</title>
    <style>
        table { border-collapse: collapse; width: 100%; max-width: 700px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        #btnContainer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>저장된 기록</h1>

<table id="recordsTable">
    <thead>
    <tr>
        <th>방향</th>
        <th>닉네임</th>
        <th>점수</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<div id="btnContainer">
    <button id="editAllBtn" disabled>기록 수정하기</button>
    <button id="backBtn">메인으로 돌아가기</button>
</div>
<script src="../js/common.js"></script>
<script src="../js/group.js"></script>
<script>
    let records = [];
    let recordSetId = null;

    async function loadRecordSetById(id) {
        try {
            const response = await authFetch(`/api/recordset/${id}`);
            if (!response.ok) throw new Error('기록 조회 실패: ' + response.status);

            const recordSet = await response.json();
            recordSetId = recordSet.id;
            records = JSON.parse(recordSet.records);

            const tbody = document.querySelector('#recordsTable tbody');
            tbody.innerHTML = '';

            records.forEach(record => {
                const tr = document.createElement('tr');

                const tdDirection = document.createElement('td');
                tdDirection.textContent = record.direction;
                tr.appendChild(tdDirection);

                const tdNickname = document.createElement('td');
                tdNickname.textContent = record.nickname;
                tr.appendChild(tdNickname);

                const tdScore = document.createElement('td');
                tdScore.textContent = record.score;
                tr.appendChild(tdScore);

                tbody.appendChild(tr);
            });

            if (records.length > 0) {
                document.getElementById('editAllBtn').disabled = false;
            }
        } catch (error) {
            alert('기록 불러오기 중 오류 발생: ' + error.message);
        }
    }

    function getIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id');
    }

    window.onload = () => {
        const id = getIdFromUrl();
        if (id) {
            loadRecordSetById(id);
        } else {
            alert('조회할 ID가 없습니다.');
        }

        document.getElementById('editAllBtn').addEventListener('click', () => {
            if (!recordSetId) {
                alert('수정할 기록 ID가 없습니다.');
                return;
            }
            const params = new URLSearchParams({
                id: recordSetId,
                records: JSON.stringify(records)
            });
            window.location.href = 'addRecord.html?' + params.toString();
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            window.location.href = 'index.html';
        });
    }
</script>

</body>
</html>
